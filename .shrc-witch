
werr ()
{
while [ "$1" != "" ]; do
    for f in ${1}/err*; do
        echo -e "\n\e[33m${f}:\e[97m"
        head -n4 $f
        egrep -i '^>>>>' $f
        tail -n5 $f
    done
    shift
done
}

wdump ()
{
WHAT=$1
shift
while [ "$1" != "" ]; do
    for f in ${1}/all_data_temp*; do
        echo -e "\n\e[33m${f}:\e[97m" 1>&2 
        gdxdump $f symb=${WHAT}
    done
    shift
done
}

wtemp ()
{
workdir="$1"
match="$2"
for f in ${workdir}/all_data_temp_${match}*; do
fbase=$(basename ${f}); fnameext=${fbase:14}; fname=temp_${fnameext%.gdx}
until rsync ${f} ${fname}_a.gdx; do sleep 1; done
ahash=$(md5sum ${fname}_a.gdx | cut -d' ' -f1)
echo "${f} -> ${fname}_a.gdx (${ahash})"
tail -n1 ${workdir}/errors_${match}*;bhash=$ahash
while [ "$ahash" == "$bhash" ]; do sleep 4;bhash=$(md5sum ${f} | cut -d' ' -f1); done
until rsync ${f} ${fname}_b.gdx; do sleep 1; done
echo "${f} -> ${fname}_b.gdx (${bhash})"; tail -n1 ${workdir}/errors_${match}*;done
}

wclean ()
{
rm -rv 225*
rm -v */*{lst,out,err}
}

wcleandir ()
{
SCENDIR=$1
PROCDIR=225_${SCENDIR}
if [ -d ${PROCDIR} ]; then
rm -rf ${PROCDIR}/*
else
mkdir -p ${PROCDIR}
fi
if [ -d ${SCENDIR} ]; then
rm ${SCENDIR}/{*lst,job*{out,err}}
else
mkdir -p ${SCENDIR}
fi
}

wrun ()
{
RUN=$1
NPROC=$2
mkdir -p ${RUN} 225_${RUN}
bsub -n${NPROC} -J "$RUN" -R "span[hosts=1]" -q serial_24h -o ${RUN}/job_${RUN}.out -e ${RUN}/job_${RUN}.err gams call_default.gms Output="${RUN}/${RUN}.lst" Procdir=225_${RUN} --nameout="${RUN}" --workdir=$RUN --gdxout=results_${RUN} ${@:3}
}

gdiff ()
{
    type dwdiff &>nul 2>&1;
    if [ $? -eq 0 ]; then
        CMD=dwdiff;
    else
        if [ ! -f dwdiff ]; then
            echo 'WARN: dwdiff tool not found... downloading'
            curl http://os.ghalkes.nl/dist/dwdiff-2.1.0.tar.bz2 > dwdiff-2.1.0.tar.bz2
            tar xjf dwdiff-2.1.0.tar.bz2 
            cd dwdiff-2.1.0
            ./configure
            make all
            mv dwdiff ../
            cd ..
            rm -rf dwdiff-2.1.0.tar.bz2 dwdiff-2.1.0
            CMD=./dwdiff;
        fi
    fi;
    SYMB=$1;
    MATCHES=$2
    DMPLIST=(one two);
    IGDX=0;
    AWKPARAM="/\"$(sed 's|,|[a-z]*"/ \&\& /"|g' <<<"${MATCHES}")[a-z]*\"/"
    for GDX in ${@:3};
    do
        echo $GDX;
        DMP=${GDX%.gdx}zzz.txt;
        rm -p "$DMP"
        gdxdump $GDX symb=$SYMB format=csv | awk "$AWKPARAM" | sed 's/","/ /g;s/"//g;s/,/ /;' > "$DMP"
        DMPLIST[IGDX]=$DMP;
        let IGDX=IGDX+1;
    done;
    $CMD -c -L -d' ,.' ${DMPLIST[@]}
}

alias bw='bjobs -w'

alias bwg='bjobs -w | egrep -i'

alias bag='bjobs -aw | grep -i'

alias bal='bjobs -aw | tail'

alias bl='bjobs -l'

alias blj='bjobs -l -J'

alias bf='bpeek -f'

alias bfj='bpeek -f -J'

alias bq='bqueues | egrep "(QUEUE_NAME|serial|gams)"'

alias bk='bkill'

alias bkj='bkill -J'

alias lsl='ls -lct | head -n20'

alias lsld='ls -lcth | egrep "^d" | grep -v " 225_" | head -n20'
